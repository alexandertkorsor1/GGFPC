<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - GGFPC</title>
    <link rel="stylesheet" href="Global.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="Login.css">
    <link rel="stylesheet" href="forgotpassword.css">
</head>

<body>
    <div class="login-page-body">
        <div class="login-page-wrapper">
            <div class="login-container">
                <div class="login-header">
                    <a href="loginggfpc.html" class="back-link">← Back to Login</a>
                    <img src="ggfpcc.png" alt="GGFPC Logo" class="login-logo">
                    <h2>Forgot Password</h2>
                    <p>Enter your phone number to receive a verification code.</p>
                </div>

                <!-- Step 1: Phone Number Input -->
                <div id="step-phone" class="forgot-step active">
                    <form id="phone-form" class="account-form">
                        <div class="form-group">
                            <label for="phone-number">Phone Number</label>
                            <input type="tel" id="phone-number" name="phone" placeholder="+231 XXX XXX XXXX" required>
                        </div>
                        <button type="submit" class="cta-button full-width">Send OTP</button>
                    </form>
                </div>

                <!-- Step 2: OTP Verification -->
                <div id="step-otp" class="forgot-step hidden">
                    <div class="otp-info">
                        <p>We sent a verification code to</p>
                        <strong id="display-phone"></strong>
                    </div>

                    <form id="otp-form" class="account-form">
                        <div class="otp-container">
                            <input type="text" class="otp-input" maxlength="1" data-index="0" inputmode="numeric">
                            <input type="text" class="otp-input" maxlength="1" data-index="1" inputmode="numeric">
                            <input type="text" class="otp-input" maxlength="1" data-index="2" inputmode="numeric">
                            <input type="text" class="otp-input" maxlength="1" data-index="3" inputmode="numeric">
                        </div>

                        <div class="timer-container">
                            <div class="timer-bar">
                                <div class="timer-progress" id="timer-progress"></div>
                            </div>
                            <p class="timer-text">
                                Code expires in <span id="timer-countdown" class="countdown">15</span> seconds
                            </p>
                        </div>

                        <p id="otp-error" class="error-message hidden"></p>

                        <button type="submit" class="cta-button full-width" id="verify-btn">Verify Code</button>

                        <div class="resend-container">
                            <button type="button" id="resend-btn" class="resend-link" disabled>
                                Resend Code
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Step 3: New Password -->
                <div id="step-password" class="forgot-step hidden">
                    <div class="success-icon">✓</div>
                    <h3>Phone Verified!</h3>
                    <p class="verified-text">Create your new password below.</p>

                    <form id="password-form" class="account-form">
                        <div class="form-group">
                            <label for="new-password">New Password</label>
                            <input type="password" id="new-password" name="newPassword" placeholder="Create a strong password" required>
                        </div>
                        <div class="form-group">
                            <label for="confirm-new-password">Confirm Password</label>
                            <input type="password" id="confirm-new-password" name="confirmPassword" placeholder="Confirm your password" required>
                        </div>
                        <button type="submit" class="cta-button full-width">Reset Password</button>
                    </form>
                </div>

                <!-- Step 4: Success -->
                <div id="step-success" class="forgot-step hidden">
                    <div class="success-container">
                        <div class="success-icon large">✓</div>
                        <h3>Password Reset Successful!</h3>
                        <p>Your password has been changed successfully.</p>
                        <a href="loginggfpc.html" class="cta-button full-width" style="text-decoration: none; text-align: center; display: block; margin-top: 1.5rem;">
                            Back to Login
                        </a>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // State
        let generatedOTP = '';
        let timerInterval = null;
        let timeRemaining = 15;
        let otpExpired = false;

        // DOM Elements
        const stepPhone = document.getElementById('step-phone');
        const stepOtp = document.getElementById('step-otp');
        const stepPassword = document.getElementById('step-password');
        const stepSuccess = document.getElementById('step-success');
        const phoneForm = document.getElementById('phone-form');
        const otpForm = document.getElementById('otp-form');
        const passwordForm = document.getElementById('password-form');
        const displayPhone = document.getElementById('display-phone');
        const timerProgress = document.getElementById('timer-progress');
        const timerCountdown = document.getElementById('timer-countdown');
        const otpError = document.getElementById('otp-error');
        const verifyBtn = document.getElementById('verify-btn');
        const resendBtn = document.getElementById('resend-btn');
        const otpInputs = document.querySelectorAll('.otp-input');

        // Generate random 4-digit OTP
        function generateOTP() {
            generatedOTP = Math.floor(1000 + Math.random() * 9000).toString();
            console.log('Generated OTP (for demo):', generatedOTP); // For testing
            alert('Demo OTP: ' + generatedOTP); // Show OTP for demo purposes
            return generatedOTP;
        }

        // Start 15-minutes timer
        function startTimer() {
            timeRemaining = 90;
            otpExpired = false;
            timerCountdown.textContent = timeRemaining;
            timerProgress.style.width = '100%';
            resendBtn.disabled = true;
            verifyBtn.disabled = false;
            otpError.classList.add('hidden');

            // Clear any existing timer
            if (timerInterval) clearInterval(timerInterval);

            timerInterval = setInterval(function() {
                timeRemaining--;
                timerCountdown.textContent = timeRemaining;
                timerProgress.style.width = ((timeRemaining / 15) * 100) + '%';

                if (timeRemaining <= 5) {
                    timerCountdown.classList.add('warning');
                    timerProgress.classList.add('warning');
                }

                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    otpExpired = true;
                    resendBtn.disabled = false;
                    verifyBtn.disabled = true;
                    timerCountdown.textContent = '0';
                    showError('OTP has expired. Please request a new code.');
                }
            }, 1000);
        }

        // Show error message
        function showError(message) {
            otpError.textContent = message;
            otpError.classList.remove('hidden');
        }

        // Hide error message
        function hideError() {
            otpError.classList.add('hidden');
        }

        // Show a specific step
        function showStep(stepElement) {
            document.querySelectorAll('.forgot-step').forEach(function(el) {
                el.classList.add('hidden');
                el.classList.remove('active');
            });
            stepElement.classList.remove('hidden');
            stepElement.classList.add('active');
        }

        // Phone form submission
        phoneForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const phone = document.getElementById('phone-number').value;

            if (!phone) {
                alert('Please enter your phone number.');
                return;
            }

            // Display phone number (masked)
            displayPhone.textContent = phone;

            // Generate OTP and show OTP step
            generateOTP();
            showStep(stepOtp);
            startTimer();

            // Focus first OTP input
            otpInputs[0].focus();
        });

        // OTP Input handling
        otpInputs.forEach(function(input, index) {
            input.addEventListener('input', function(e) {
                const value = e.target.value;

                // Only allow numbers
                if (!/^\d*$/.test(value)) {
                    e.target.value = '';
                    return;
                }

                // Move to next input
                if (value && index < otpInputs.length - 1) {
                    otpInputs[index + 1].focus();
                }

                hideError();
            });

            input.addEventListener('keydown', function(e) {
                // Move to previous input on backspace
                if (e.key === 'Backspace' && !e.target.value && index > 0) {
                    otpInputs[index - 1].focus();
                }
            });

            // Handle paste
            input.addEventListener('paste', function(e) {
                e.preventDefault();
                const pastedData = e.clipboardData.getData('text').slice(0, 4);

                if (/^\d+$/.test(pastedData)) {
                    pastedData.split('').forEach(function(char, i) {
                        if (otpInputs[i]) {
                            otpInputs[i].value = char;
                        }
                    });
                    otpInputs[Math.min(pastedData.length, otpInputs.length - 1)].focus();
                }
            });
        });

        // OTP form submission
        otpForm.addEventListener('submit', function(e) {
            e.preventDefault();

            if (otpExpired) {
                showError('OTP has expired. Please request a new code.');
                return;
            }

            // Get entered OTP
            let enteredOTP = '';
            otpInputs.forEach(function(input) {
                enteredOTP += input.value;
            });

            if (enteredOTP.length !== 4) {
                showError('Please enter the complete 4-digit code.');
                return;
            }

            // Verify OTP
            if (enteredOTP === generatedOTP) {
                clearInterval(timerInterval);
                showStep(stepPassword);
            } else {
                showError('Invalid OTP. Please try again.');
                // Clear inputs
                otpInputs.forEach(function(input) {
                    input.value = '';
                });
                otpInputs[0].focus();
            }
        });

        // Resend OTP
        resendBtn.addEventListener('click', function() {
            // Clear previous OTP inputs
            otpInputs.forEach(function(input) {
                input.value = '';
            });
            timerCountdown.classList.remove('warning');
            timerProgress.classList.remove('warning');

            // Generate new OTP and restart timer
            generateOTP();
            startTimer();
            otpInputs[0].focus();
        });

        // Password form submission
        passwordForm.addEventListener('submit', function(e) {
            e.preventDefault();

            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-new-password').value;

            if (!newPassword || !confirmPassword) {
                alert('Please fill in all fields.');
                return;
            }

            if (newPassword !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }

            if (newPassword.length < 6) {
                alert('Password must be at least 6 characters long.');
                return;
            }

            // Success - In real app, send to backend
            showStep(stepSuccess);
        });
    </script>
</body>

</html>